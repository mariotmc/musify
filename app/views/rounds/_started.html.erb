<%= turbo_frame_tag round, class: "block w-full h-full" do %>
  <div data-controller="timer"
       data-timer-end-time-value="<%= (Time.current + 30.seconds).to_i %>"
       data-timer-hint-outlet="#hint"
       class="h-full">
    <div class="relative w-20 h-20 mx-auto mb-4">
      <svg class="w-full h-full" viewBox="0 0 100 100">
        <circle class="text-gray-200 stroke-current" stroke-width="10" cx="50" cy="50" r="40" fill="transparent"/>
        <circle data-timer-target="progressCircle"
                class="text-yellow-500 stroke-current transition-all duration-200 ease-linear"
                stroke-width="10"
                stroke-linecap="round"
                cx="50"
                cy="50"
                r="40"
                fill="transparent"
                stroke-dasharray="251.2"
                stroke-dashoffset="0"
                transform="rotate(-90 50 50)"/>
      </svg>
      <div data-timer-target="timerDisplay"
           class="absolute inset-0 flex items-center justify-center text-3xl font-bold">
        30
      </div>
    </div>

    <div class="flex gap-10">
      <div>
        <%= image_tag round.current_song.image, loading: "lazy", data: { timer_target: "image"}, class: "max-w-40 h-auto rounded-lg transition-all" %>
        <p data-controller="hint"
           data-hint-initial-hint-value="<%= round.current_song.initial_hint %>"
           data-hint-first-letter-hint-value="<%= round.current_song.hint_with_first_letters %>"
           data-hint-both-letters-hint-value="<%= round.current_song.hint_with_both_letters %>"
           id="hint">
          <span data-hint-target="hintDisplay"></span>
        </p>
        <audio autoplay class="hidden">
          <source src="<%= round.current_song.preview_url %>" type="audio/mpeg">
        </audio>
      </div>

      <div class="self-end overflow-hidden w-full">
        <%= turbo_frame_tag "guesses", class: "w-full h-full" do %>
          <%= render partial: "guesses/guess", collection: round.guesses %>
        <% end %>

        <%= form_with model: [round.game, round, Guess.new], data: { controller: "guess-form" } do |f| %>
          <%= f.hidden_field :song_id, value: round.current_song.id %>
          <%= f.hidden_field :player_id, value: player.id %>

          <%= turbo_frame_tag "guesses_input" do %>
            <% if round.current_song.player == player %>
              <%= f.text_field :content, placeholder: "Not allowed to guess your own song", disabled: true, class: "w-full cursor-not-allowed" %>
            <% elsif player.guessed_song_correctly?(song: round.current_song) %>
              <%= f.text_field :content, disabled: true, class: "w-full cursor-not-allowed" %>
            <% else %>
              <%= f.text_field :content, placeholder: "Take a guess", data: { guess_form_target: "input" }, autofocus: true, class: "w-full" %>
            <% end %>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
<% end %>
